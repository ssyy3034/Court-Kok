{% extends "base.html" %}

{% block title %}회원가입 - Court-Kok{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold text-center text-gray-800 mb-6">회원가입</h1>
<form id="signup-form" class="space-y-4">
    <input type="text" id="signup-name" placeholder="이름 (한글)" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
    <input type="text" id="signup-id" placeholder="아이디" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
    <input type="password" id="signup-pw" placeholder="비밀번호" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
    <input type="password" id="signup-confirm-pw" placeholder="비밀번호 확인" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
    <input type="email" id="signup-email" placeholder="이메일" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
    <input type="tel" id="signup-phone" placeholder="전화번호" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
    <button type="submit" class="w-full bg-green-600 text-white font-semibold p-3 rounded-lg shadow-md hover:bg-green-700 transition duration-200">가입</button>
</form>
<div class="text-center mt-4">
    <a href="/login" class="text-sm text-blue-500 hover:text-blue-700 transition duration-200">로그인으로 돌아가기</a>
</div>
{% endblock %}

{% block scripts %}
<script>
    const signupForm = document.getElementById('signup-form');

    signupForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        showLoader();
        const name = document.getElementById('signup-name').value;
        const id = document.getElementById('signup-id').value;
        const pw = document.getElementById('signup-pw').value;
        const confirmPw = document.getElementById('signup-confirm-pw').value;
        const email = document.getElementById('signup-email').value;
        const phone = document.getElementById('signup-phone').value;

        if (!name || !id || !pw || !confirmPw || !email || !phone) {
            showAlert("모든 필드를 채워주세요.");
            hideLoader();
            return;
        }

        if (pw !== confirmPw) {
            showAlert("비밀번호가 일치하지 않습니다.");
            hideLoader();
            return;
        }

        try {
            const response = await fetch('/api/signup', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({name, id, pw, email, phone})
            });
            const result = await response.json();
            
            if (response.ok) {
                showAlert(result.message + " 로그인 페이지로 이동합니다.");
                setTimeout(() => {
                    window.location.href = '/login';
                }, 1500); // Show success message for 1.5 seconds before redirecting
            } else {
                 showAlert(result.message || "회원가입 중 오류가 발생했습니다.");
            }
        } catch (error) {
            showAlert("네트워크 오류가 발생했습니다.");
        } finally {
            hideLoader();
        }
    });

    // If a token already exists, redirect to the main page.
    if (getToken()) {
        window.location.href = '/';
    }
</script>
{% endblock %}