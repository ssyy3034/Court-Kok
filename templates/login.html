{% extends "base.html" %}

{% block title %}로그인 - Court-Kok{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold text-center text-gray-800 mb-6">로그인</h1>
<form id="login-form" class="space-y-4">
    <input type="text" id="login-id" placeholder="아이디" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
    <input type="password" id="login-pw" placeholder="비밀번호" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
    <button type="submit" class="w-full bg-blue-600 text-white font-semibold p-3 rounded-lg shadow-md hover:bg-blue-700 transition duration-200">로그인</button>
</form>
<div class="text-center mt-4">
    <a href="/signup" class="text-sm text-blue-500 hover:text-blue-700 transition duration-200">회원가입</a>
</div>
{% endblock %}

{% block scripts %}
<script>
    const loginForm = document.getElementById('login-form');

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        showLoader();
        const id = document.getElementById('login-id').value;
        const pw = document.getElementById('login-pw').value;

        if (!id || !pw) {
            showAlert("아이디와 비밀번호를 모두 입력해주세요.");
            hideLoader();
            return;
        }

        try {
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({id, pw})
            });
            const result = await response.json();

            if (response.ok) {
                const token = result.access_token;
                if (!token) {
                    showAlert("토큰 발급에 실패했습니다.");
                    return;
                }
                setToken(token);
                // On successful login, redirect to the main page.
                window.location.href = '/';
            } else {
                showAlert(result.message || "로그인에 실패했습니다.");
            }
        } catch (error) {
            showAlert("네트워크 오류가 발생했습니다.");
        } finally {
            hideLoader();
        }
    });

    // If a token already exists, redirect to the main page.
    // This prevents a logged-in user from seeing the login page again.
    if (getToken()) {
        window.location.href = '/';
    }
</script>
{% endblock %}